<h1><img src="resources/icon.png" alt="rasterbender" /> <img src="resources/icon.png" alt="rasterbender" /> <img src="resources/icon.png" alt="rasterbender" /> RasterBender <img src="resources/icon.png" alt="rasterbender" /> <img src="resources/icon.png" alt="rasterbender" /> <img src="resources/icon.png" alt="rasterbender" /></h1>

<p>RasterBender is an <strong>EXPERIMENTAL</strong> QGIS Python plugin allowing to distort raster layers using pairs of points. This allows to match data that has complex non-uniform and non-linear deformations (historical maps, hand drawn sketches...).</p>

<p><strong>This plugin is not production ready at all</strong> and you should not use it beside for testing. See <em>limitations</em> below to see what to expect.</p>

<p><img src="resources/animation.gif" alt="rasterbender" /></p>

<h2>How to use</h2>

<p>Launch RasterBender from the plugins menu or from the plugin toolbar.</p>

<p>RasterBender works a bit like the georeferencer : you have to create pairs of points, the first one being the original location, and the second one being the target location.</p>

<p>To do so, RasterBender uses plain Linestring layers. Each pair is defined by the starting point and ending point of a Line in this layer.
You can either use one of your own Linestring layers, or use the <img src="resources/mActionCaptureLine.png" alt="create pairs layers" /> button from the RasterBender window.</p>

<p>You can also create a constraint layers, which will constrain the triangulation created by the plugin. This can be useful if you have some artifact generated by unwanted triangles. The constraints are line that should go from one starting point to another. Use the preview to see if the triangulation is affected as expected.</p>

<p>If you use RasterBender's layers, I recommend installing the "Save memory layer" plugin which will allow to save your work.</p>

<p>Once the layer to bend and the pairs layer are chosen, simply hit "run", wait a while (it can be quite long), and a new raster will be saved at the target path.</p>

<h3>How does the bending work</h3>

<p>The first points of all pairs will be triangulated, and this triangulation will be mapped on the last points of all pairs. The raster layer will then be deformed by matching the triangulation.</p>

<p>The "buffer" parameters sets a buffer around the triangulation, so that the transformation ends more smoothely on the edges. Hold the "preview" button to see the size of the buffer.</p>

<p>Using this method will <strong>INDUCE DEFORMATIONS</strong>. You should <strong>ONLY</strong> use it if your data is already deformed, and not to accomplish CRS transformations nor linear/affine transformations.</p>

<h3>The block size parameter</h3>

<p>To avoid using too much memory, the target raster is divided into square blocks. The bigger the blocks, the more triangles must be analysed at the same time. The plugin will tell you how many triangles the trifinder must analyse. If this number is too high (more than 10 most of the time), try reducing the block size to gain speed.</p>

<h2>Feedback / Bugs / Contribute</h2>

<p>Please report bugs and ideas on the issue tracker : https://github.com/olivierdalang/RasterBender/issues</p>

<p>Or send me some feedback at : olivier.dalang@gmail.com</p>

<h2>Limitations</h2>

<p>RasterBender is in its early stages of developpement, and is currently tested only with GeoTIFF and RGB (3 channels) rasters. It is not expected to work with other file types.
The current raster bending algorithm is very sub-optimal and thus very slow.</p>

<h2>Version history</h2>

<ul>
<li>2014-11-17 - Version 0.0 : intial release</li>
</ul>

<h2>Roadmap</h2>

<h3>Not confirmed</h3>

<ul>
<li>change algorithm to avoid the need of using a trifinder</li>
</ul>

<h2>How it works (internally)</h2>

<p>Here's how it works :</p>

<p>Preparing the mesh</p>

<ol>
<li>Get a triangular mesh by doing a Delaunay triangulation of all original input points (starting points of the lines in the Raster Bender layer)</li>
<li>Adapt this mesh on the ending points of the lines</li>
<li>Get the convex hull of the points, offset it by some factor to have a smooth transition on the borders.</li>
</ol>

<p>Doing the transformation</p>

<ol>
<li>For each pixel of the target layer, find in which triangle it lies, and get it's barycentric coordinates in that triangle. Apply those barycentric coordinates to the source triangles, find the corresponding pixel, and copy it's compnonents.</li>
</ol>
